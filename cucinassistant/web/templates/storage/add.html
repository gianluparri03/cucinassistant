{% extends "templates/base.html" %}

{% set title = 'Aggiungi articoli' %}

{% set back_link = '../' %}

{% block imports %}
    <script>
        function isEmpty(item) {
            return !item.find("input.name").val() &&
                !item.find("input.expiration").val() &&
                !item.find("input.quantity").val();
        }

        function updateInputs(e, first=false) {
            let target = e ? $(e.target).parent() : null;
            if (e != null) console.log(isEmpty(target));
            console.log(target);

            if (first || (target.get(0) == $(".storage-item").get(-1) && !isEmpty(target))) {
                let ne = $(`<div class="storage-item">` +
                               `<input class="name" type="text" placeholder="Nome" required>` +
                               `<input class="expiration" type="date" placeholder="Scadenza">` +
                               `<input class="quantity" type="number" min="0" step="1" placeholder="Quantit&agrave;">` +
                           `</div>`);

                $('#new-elements').append(ne);
                ne.on("change", updateInputs);
            } else if (isEmpty(target)) {
                target.remove();
            }
        }

        function save() {
            var data = "";
            for (item of $('.item')) data += item.children[0].value + ';' + item.children[1].value + ';' + item.children[2].value + '|';
            $('#data').val(data.slice(0, -1));
        }

        window.onload = function() { updateInputs(null, true); };
    </script>
{% endblock %}

{% block content %}
    <form method="POST">
        <input id="data" name="data" hidden>

        <div id="new-elements"></div>

        <button class="icon-text" onclick="save()"><i class="fas fa-check"></i> Conferma</button>
    </form>
{% endblock %}
